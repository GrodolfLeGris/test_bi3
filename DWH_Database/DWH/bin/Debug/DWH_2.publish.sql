/*
Deployment script for PROD_DWH

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "PROD_DWH"
:setvar DefaultFilePrefix "PROD_DWH"
:setvar DefaultDataPath ""
:setvar DefaultLogPath ""

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
PRINT N'Rename refactoring operation with key acf8135e-41b0-45a0-82ad-9183ee008dd0, 07b5f858-6409-4900-be39-eb45a67eca09 is skipped, element [dbo].[DIM_ACCOUNTING_ACCOUNT].[SITE_CODE] (SqlSimpleColumn) will not be renamed to ORGANIZATIONLVL3ID';


GO
PRINT N'Rename refactoring operation with key b397b013-b5fe-4dd6-944b-0ebb5d1d4599 is skipped, element [dbo].[DIM_ACCOUNTING_CLASSIFICATION].[SITE_CODE] (SqlSimpleColumn) will not be renamed to ORGANIZATIONLVL3ID';


GO
PRINT N'Rename refactoring operation with key f99acf82-854d-46a4-a286-eb10bd1a47d9 is skipped, element [dbo].[DIM_COMMON_CUSTOMER].[SITE_CODE] (SqlSimpleColumn) will not be renamed to ORGANIZATIONLVL3ID';


GO
PRINT N'Rename refactoring operation with key 0034d18b-f824-4601-9ec7-8f2c6333ed59 is skipped, element [dbo].[DIM_COMMON_BUILDING].[SITE] (SqlSimpleColumn) will not be renamed to ORGANIZATIONLVL3ID';


GO
PRINT N'Creating User [PROD_DWH_User]...';


GO
CREATE USER [PROD_DWH_User] FOR LOGIN [PROD_DWH_USER];


GO
REVOKE CONNECT TO [PROD_DWH_User];


GO
PRINT N'Creating Role Membership [db_datareader] for [PROD_DWH_User]...';


GO
EXECUTE sp_addrolemember @rolename = N'db_datareader', @membername = N'PROD_DWH_User';


GO
PRINT N'Creating Role Membership [db_datawriter] for [PROD_DWH_User]...';


GO
EXECUTE sp_addrolemember @rolename = N'db_datawriter', @membername = N'PROD_DWH_User';


GO
PRINT N'Creating Table [dbo].[DIM_ACCOUNTING_ACCOUNT]...';


GO
CREATE TABLE [dbo].[DIM_ACCOUNTING_ACCOUNT] (
    [ORGANIZATIONLVL3ID] INT           NOT NULL,
    [ACCOUNT_NO]         NVARCHAR (20) NOT NULL,
    [ACCOUNT_NAME]       NVARCHAR (60) NULL,
    [BASE_NO]            NVARCHAR (10) NULL,
    [COST_CENTER_NO]     NVARCHAR (10) NULL,
    [LOCATION_NO]        NVARCHAR (10) NULL,
    [CATEGORY_TYPE]      NVARCHAR (20) NULL,
    [CLASSIFICATION]     NVARCHAR (40) NULL,
    CONSTRAINT [PK_DIM_ACCOUNTING_ACCOUNT_1] PRIMARY KEY CLUSTERED ([ORGANIZATIONLVL3ID] ASC, [ACCOUNT_NO] ASC)
);


GO
PRINT N'Creating Table [dbo].[DIM_ACCOUNTING_CLASSIFICATION]...';


GO
CREATE TABLE [dbo].[DIM_ACCOUNTING_CLASSIFICATION] (
    [ORGANIZATIONLVL3ID] INT           NOT NULL,
    [ACCOUNT_NO]         NVARCHAR (20) NOT NULL,
    [CLASSIFICATION]     NVARCHAR (40) NULL,
    CONSTRAINT [PK_DIM_ACCOUNTING_CLASSIFICATION] PRIMARY KEY CLUSTERED ([ORGANIZATIONLVL3ID] ASC, [ACCOUNT_NO] ASC)
);


GO
PRINT N'Creating Table [dbo].[DIM_COMMON_ACTIVITY]...';


GO
CREATE TABLE [dbo].[DIM_COMMON_ACTIVITY] (
    [ORGANIZATIONLVL2ID]  INT           NOT NULL,
    [ACTIVITY_SHORT_NAME] NVARCHAR (10) NOT NULL,
    [ACTIVITY_NAME]       NVARCHAR (50) NOT NULL,
    CONSTRAINT [PK_ACTIVITY] PRIMARY KEY CLUSTERED ([ORGANIZATIONLVL2ID] ASC, [ACTIVITY_SHORT_NAME] ASC)
);


GO
PRINT N'Creating Table [dbo].[DIM_COMMON_BUILDING]...';


GO
CREATE TABLE [dbo].[DIM_COMMON_BUILDING] (
    [BUILDING_KEY]       INT           NOT NULL,
    [BUILDING_CODE]      NVARCHAR (50) NULL,
    [ORGANIZATIONLVL3ID] INT           NULL,
    CONSTRAINT [PK_DIM_BUILDING] PRIMARY KEY CLUSTERED ([BUILDING_KEY] ASC)
);


GO
PRINT N'Creating Table [dbo].[DIM_COMMON_BUSINESS_UNIT]...';


GO
CREATE TABLE [dbo].[DIM_COMMON_BUSINESS_UNIT] (
    [ORGANIZATIONLVL2ID]       INT           NOT NULL,
    [BUSINESS_UNIT_SHORT_NAME] NVARCHAR (10) NOT NULL,
    [BUSINESS_UNIT]            NVARCHAR (50) NOT NULL,
    [ACTIVITY_NAME]            NVARCHAR (50) NULL,
    CONSTRAINT [PK_DIM_BUSINESS_UNIT] PRIMARY KEY CLUSTERED ([ORGANIZATIONLVL2ID] ASC, [BUSINESS_UNIT_SHORT_NAME] ASC)
);


GO
PRINT N'Creating Table [dbo].[DIM_COMMON_CUSTOMER]...';


GO
CREATE TABLE [dbo].[DIM_COMMON_CUSTOMER] (
    [ORGANIZATIONLVL3ID] INT          NULL,
    [CUSTOMER_NO]        INT          NOT NULL,
    [CUSTOMER_CODE]      VARCHAR (50) NULL,
    [NAME]               VARCHAR (75) NULL,
    [CUSTOMER_TYPE]      VARCHAR (50) NULL,
    [CUSTOMER_STATUS]    BIT          NULL,
    CONSTRAINT [PK_DIM_COMMON_CUSTOMER_1] PRIMARY KEY CLUSTERED ([CUSTOMER_NO] ASC)
);


GO
PRINT N'Creating Table [dbo].[DIM_COMMON_SITE]...';


GO
CREATE TABLE [dbo].[DIM_COMMON_SITE] (
    [ORGANIZATIONLVL3ID] INT           NOT NULL,
    [SITE_CODE]          NVARCHAR (20) NOT NULL,
    [SITE]               NVARCHAR (50) NOT NULL,
    [SITE_SHORT_NAME]    NVARCHAR (10) NULL,
    [BUSINESS_UNIT]      NVARCHAR (50) NULL,
    [COUNTRY]            NVARCHAR (50) NULL,
    [STATE]              NVARCHAR (50) NULL,
    [PLEXUS_CUSTOMER_NO] INT           NULL,
    CONSTRAINT [PK_DIM_COMMON_SITE] PRIMARY KEY CLUSTERED ([ORGANIZATIONLVL3ID] ASC, [SITE_CODE] ASC)
);


GO
-- Refactoring step to update target server with deployed transaction logs

IF OBJECT_ID(N'dbo.__RefactorLog') IS NULL
BEGIN
    CREATE TABLE [dbo].[__RefactorLog] (OperationKey UNIQUEIDENTIFIER NOT NULL PRIMARY KEY)
    EXEC sp_addextendedproperty N'microsoft_database_tools_support', N'refactoring log', N'schema', N'dbo', N'table', N'__RefactorLog'
END
GO
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'acf8135e-41b0-45a0-82ad-9183ee008dd0')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('acf8135e-41b0-45a0-82ad-9183ee008dd0')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '07b5f858-6409-4900-be39-eb45a67eca09')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('07b5f858-6409-4900-be39-eb45a67eca09')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'b397b013-b5fe-4dd6-944b-0ebb5d1d4599')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('b397b013-b5fe-4dd6-944b-0ebb5d1d4599')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'f99acf82-854d-46a4-a286-eb10bd1a47d9')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('f99acf82-854d-46a4-a286-eb10bd1a47d9')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '0034d18b-f824-4601-9ec7-8f2c6333ed59')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('0034d18b-f824-4601-9ec7-8f2c6333ed59')

GO

GO
PRINT N'Update complete.';


GO
